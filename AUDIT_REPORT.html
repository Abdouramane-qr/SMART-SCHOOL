<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rapport d'Audit Consolide</title>
  <style>
    :root {
      color-scheme: light;
      --primary: #217EFD;
      --background: #F1F5F7;
      --surface: #FFFFFF;
      --neutral: #B3B3B3;
      --text: #0f172a;
    }
    body {
      margin: 0;
      background: var(--background);
      color: var(--text);
      font-family: "Source Sans 3", "Segoe UI", Tahoma, sans-serif;
      line-height: 1.6;
    }
    .page {
      max-width: 900px;
      margin: 32px auto;
      padding: 24px;
      background: var(--surface);
      border: 1px solid var(--neutral);
      border-radius: 12px;
    }
    h1 {
      font-size: 28px;
      margin: 0 0 8px 0;
    }
    h2 {
      font-size: 20px;
      margin: 24px 0 8px 0;
      border-left: 4px solid var(--primary);
      padding-left: 10px;
    }
    ul {
      margin: 8px 0 16px 20px;
    }
    .meta {
      color: #334155;
      font-size: 14px;
    }
    .section {
      margin-bottom: 16px;
    }
    @page {
      size: A4;
      margin: 20mm 15mm 20mm 15mm;
    }
    @media print {
      body {
        background: #ffffff;
      }
      .page {
        margin: 0;
        border: none;
        border-radius: 0;
        box-shadow: none;
        width: auto;
      }
      .header {
        position: fixed;
        top: 10mm;
        left: 15mm;
        right: 15mm;
        font-size: 12px;
        color: #475569;
        border-bottom: 1px solid var(--neutral);
        padding-bottom: 4mm;
        display: flex;
        justify-content: space-between;
      }
      .footer {
        position: fixed;
        bottom: 10mm;
        left: 15mm;
        right: 15mm;
        font-size: 12px;
        color: #475569;
        border-top: 1px solid var(--neutral);
        padding-top: 4mm;
        display: flex;
        justify-content: space-between;
      }
      .page-number:after {
        content: "Page " counter(page) " / " counter(pages);
      }
    }
  </style>
</head>
<body>
  <main class="page">
    <div class="header">
      <div>Rapport d'audit</div>
      <div>Date: 2026-01-06</div>
    </div>
    <h1>Rapport d'Audit Consolide</h1>
    <div class="meta">Date: 2026-01-06 &nbsp;•&nbsp; Scope: React + Filament + API Laravel</div>

    <section class="section">
      <h2>1) Etat global</h2>
      <ul>
        <li>Design/branding: palette POPSPACE centralisee et appliquee (React + Filament).</li>
        <li>Performance: lazy loading OK, mais pagination front trop large (per_page=1000).</li>
        <li>Automatisation: finance centralisee + events cache + audits automatiques.</li>
        <li>Coherence: React = usage quotidien, Filament = admin (redirections OK).</li>
      </ul>
    </section>

    <section class="section">
      <h2>2) Design / Branding</h2>
      <ul>
        <li>Typographie unifiee: Source Sans 3.</li>
        <li>Couleurs: tokens primary/background/neutral/white/surface alignes.</li>
        <li>Etats: success/warning mappes sur la palette, destructive reserve au critique.</li>
        <li>Lisibilite: contraste ameliore (muted-foreground ajuste).</li>
      </ul>
    </section>

    <section class="section">
      <h2>3) Performance & Caching</h2>
      <ul>
        <li>Cache tague par ecole + annee, invalidation + warm via events finance.</li>
        <li>Goulot principal: payloads lourds cote React (segmentation en cours).</li>
        <li>Pagination segmentee: listes lourdes chargees en pages (per_page=200) pour reduire la taille des reponses.</li>
        <li>Actions recommandees: paginer toutes les listes React restantes + Resources "light" sur les index.</li>
      </ul>
    </section>

    <section class="section">
      <h2>4) Automatisation & Finance</h2>
      <ul>
        <li>Finance centralisee dans FinanceService, events auto (paiements/depenses/salaires).</li>
        <li>Assets creent une depense liee automatiquement (expense_id).</li>
        <li>Cycle de vie assets: actif/panne/vendu.</li>
        <li>Logs d'audit automatiques pour assets + finance.</li>
        <li>Dashboard Filament: KPI + graphique mensuel pour supervision rapide.</li>
        <li>Dashboard Filament: filtres ecole/annee + widget Eleves/Classes.</li>
        <li>Dashboard Filament: filtres live (sans reload) via Livewire.</li>
      </ul>
    </section>

    <section class="section">
      <h2>5) Risques / Limites</h2>
      <ul>
        <li>Double saisie possible React/Filament sur certains modules.</li>
        <li>Devise/school_id non deduit pour depenses sans regle explicite.</li>
        <li>Pagination front encore large -> latence percue.</li>
      </ul>
    </section>

    <section class="section">
      <h2>6) References</h2>
      <ul>
        <li>AUDIT_GENERAL.md</li>
        <li>AUDIT_COLORS_TYPO.md</li>
        <li>AUDIT_DESIGN_LISIBILITE.md</li>
        <li>AUDIT_PERFORMANCE.md</li>
        <li>AUDIT_AUTOMATION.md</li>
        <li>AUDIT_UI_PIXEL.md</li>
        <li>AUDIT_READINESS.md</li>
        <li>AUDIT_COHERENCE.md</li>
        <li>AUDIT_ADMIN_REDUCTION.md</li>
        <li>AUDIT_ROLES_PERMISSIONS.md</li>
      </ul>
    </section>
    <section class="section">
      <h2>7) Verification complementaire</h2>
      <ul>
        <li>Buttons: variantes unifiees (primary/secondary/danger) et usages coherents.</li>
        <li>Couleurs: aucune classe Tailwind hors palette detectee.</li>
        <li>Typo/branding: Source Sans 3 + tokens POPSPACE alignes React/Filament.</li>
        <li>Coherence front/back: finance et assets synchronises via services + events.</li>
        <li>Statuts: mapping centralise success/warning/destructive (React + Filament).</li>
      </ul>
    </section>

    <section class="section">
      <h2>8) Amelioration proposee</h2>
      <ul>
        <li>Centraliser une table de mapping des statuts (success/warn/destructive) partagee React + Filament pour eviter les divergences futures.</li>
      </ul>
    </section>
    <div class="footer">
      <div>Smart School Hub • Rapport d'audit</div>
      <div class="page-number"></div>
    </div>
  </main>
</body>
</html>
